<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TV Player</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15"></script>
<script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;background:#000;font-family:Arial}

/* VIDEO */
#video-container{position:relative;height:100%}
video{width:100%;height:100%;object-fit:contain;background:#000}

/* CONTROLS */
.ctrl{
  position:absolute;
  background:rgba(0,0,0,.6);
  color:#fff;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  font-size:16px;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:20
}
#play{left:12px;bottom:100px}
#mute{right:12px;bottom:100px}
#airplay{left:12px;bottom:55px}
#cast{right:12px;bottom:55px}
#volume{
  position:absolute;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:240px;
  opacity:0;
  pointer-events:none;
  transition:.3s;
}

/* CHANNEL BAR */
#channels{
  position:fixed;
  top:0;left:0;right:0;
  display:flex;
  flex-wrap:wrap;
  gap:4px;
  padding:6px;
  justify-content:center;
  background:rgba(15,15,15,.85);
  z-index:30;
  transition:.4s
}
#channels.hidden{transform:translateY(-100%);opacity:0}
#channels button{
  background:#2a2a2a;
  color:#fff;
  border:none;
  padding:8px 16px;
  border-radius:6px
}
#channels button.active{background:#0a84ff}

/* STATUS */
#status{
  position:absolute;
  bottom:160px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,.6);
  color:#aaa;
  padding:6px 12px;
  border-radius:6px;
  transition:.3s;
  z-index:20
}

/* PiP */
#pip{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  z-index:100
}
#pip-header{
  height:50px;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 14px
}
#pip iframe{flex:1;border:none}
</style>
</head>

<body>

<div id="video-container">
  <video id="video" playsinline autoplay muted></video>

  <button id="play" class="ctrl">Pause</button>
  <button id="mute" class="ctrl">ðŸ”‡</button>
  <button id="airplay" class="ctrl">AirPlay</button>
  <button id="cast" class="ctrl">Cast</button>
  <input id="volume" type="range" min="0" max="1" step="0.01" value="0.5">
  <div id="status">Loadingâ€¦</div>
</div>

<div id="channels"></div>

<div id="pip">
  <div id="pip-header">
    <span id="pip-title"></span>
    <button onclick="closePiP()">âœ•</button>
  </div>
  <iframe></iframe>
</div>

<script>
const video = document.getElementById('video');
const status = document.getElementById('status');
const channelBar = document.getElementById('channels');
const controls = document.querySelectorAll('.ctrl,#volume');
let hls = null, hideTimer;

/* CHANNELS */
const channels = [
  {name:"RoyaTV",url:"https://royatv-live.daioncdn.net/royatv/royatv_720p.m3u8"},
  {name:"Jordan",url:"https://jrtv-live.ercdn.net/jordanhd/jordanhd_720p.m3u8"},
  {name:"Mamlaka",url:"https://bcovlive-a.akamaihd.net/4109c7ba30fd4a44ad9afe917c67a8c8/eu-central-1/6415809151001/profile_2/chunklist_dvr.m3u8"},
  {name:"Amman",url:"https://ammantv-live.ercdn.net/ammantvhd/ammantvhd.m3u8"}
];

/* BUILD BUTTONS */
channels.forEach((c,i)=>{
  const b=document.createElement('button');
  b.textContent=c.name;
  b.onclick=()=>playChannel(c.url,b);
  channelBar.appendChild(b);
  if(i===0) setTimeout(()=>playChannel(c.url,b),100);
});

/* PLAY STREAM (AUTOPLAY FIXED) */
function playChannel(url,btn){
  document.querySelectorAll('#channels button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');

  status.style.opacity=1;
  status.textContent="Loadingâ€¦";

  if(hls) hls.destroy();
  hls=new Hls();
  hls.loadSource(url);
  hls.attachMedia(video);

  hls.on(Hls.Events.MANIFEST_PARSED,()=>{
    video.muted = true;        // REQUIRED FOR AUTOPLAY
    video.play().catch(()=>{});
  });

  video.onplaying=()=>status.style.opacity=0;
}

/* CONTROLS AUTO SHOW */
function showUI(){
  channelBar.classList.remove('hidden');
  controls.forEach(c=>{c.style.opacity=1;c.style.pointerEvents="auto"});
  clearTimeout(hideTimer);
  hideTimer=setTimeout(()=>{
    channelBar.classList.add('hidden');
    controls.forEach(c=>{c.style.opacity=0;c.style.pointerEvents="none"});
  },3000);
}
document.addEventListener('click',showUI,{passive:true});

/* PLAY / MUTE */
document.getElementById('play').onclick=()=>{
  video.paused?video.play():video.pause();
};
document.getElementById('mute').onclick=()=>{
  video.muted=!video.muted;
};
document.getElementById('volume').oninput=e=>{
  video.volume=e.target.value;
  video.muted=false;
};

/* AIRPLAY */
document.getElementById('airplay').onclick=()=>{
  video.webkitShowPlaybackTargetPicker?.();
};

/* CHROMECAST */
window.__onGCastApiAvailable=loaded=>{
  if(!loaded)return;
  cast.framework.CastContext.getInstance().setOptions({
    receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,
    autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
  });
};
document.getElementById('cast').onclick=async()=>{
  const ctx=cast.framework.CastContext.getInstance();
  await ctx.requestSession();
  const media=new chrome.cast.media.MediaInfo(video.currentSrc,"application/x-mpegurl");
  ctx.getCurrentSession().loadMedia(new chrome.cast.media.LoadRequest(media));
};
</script>

</body>
</html>
