<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TV â€¢ Digital Frame</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family:Arial,Helvetica,sans-serif;
}

#video-container {
  position:relative;
  width:100%;
  height:100%;
}

#video {
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
}

/* Controls */
.ctrl {
  position:absolute;
  bottom:6px;
  padding:6px 14px;
  font-size:15px;
  background:rgba(0,0,0,0.65);
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  z-index:10;
  transition:opacity .6s, background .2s;
}

.ctrl:hover { background:rgba(40,40,40,0.9); }

#play-pause { left:10px; }
#unmute-btn { right:10px; min-width:48px; }

#volume {
  position:absolute;
  bottom:6px;
  left:50%;
  transform:translateX(-50%);
  width:260px;
  z-index:9;
}

#status {
  position:absolute;
  bottom:60px;
  left:50%;
  transform:translateX(-50%);
  color:#ccc;
  font-size:13px;
  background:rgba(0,0,0,.6);
  padding:6px 14px;
  border-radius:8px;
  pointer-events:none;
  z-index:8;
  transition:opacity 1s;
}
</style>
</head>

<body>
<div id="video-container">
  <video id="video" autoplay muted playsinline></video>

  <button id="play-pause" class="ctrl">Pause</button>
  <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
  <button id="unmute-btn" class="ctrl">ðŸ”‡</button>

  <div id="status">Loadingâ€¦</div>
</div>

<script>
const video = document.getElementById('video');
const status = document.getElementById('status');
const playPauseBtn = document.getElementById('play-pause');
const unmuteBtn = document.getElementById('unmute-btn');
const volume = document.getElementById('volume');
const controls = document.querySelectorAll('.ctrl, #volume');

const STREAM_URL = "https://royatv-live.daioncdn.net/royatv/royatv_360p.m3u8";
let hls = null;
let lastProgress = Date.now();

/* -------------------- UI -------------------- */
function updateMute() {
  unmuteBtn.textContent = video.muted ? 'ðŸ”‡' : 'ðŸ”Š';
}

playPauseBtn.onclick = () => {
  if (video.paused) {
    video.play().catch(()=>{});
    playPauseBtn.textContent = 'Pause';
  } else {
    video.pause();
    playPauseBtn.textContent = 'Play';
  }
};

unmuteBtn.onclick = () => {
  video.muted = !video.muted;
  updateMute();
};

volume.oninput = () => {
  video.volume = volume.value;
  if (video.volume > 0 && video.muted) {
    video.muted = false;
    updateMute();
  }
};

/* -------------------- Controls auto-hide -------------------- */
let uiTimer;
function showControls() {
  controls.forEach(c => c.style.opacity = '1');
  clearTimeout(uiTimer);
  uiTimer = setTimeout(hideControls, 10000);
}
function hideControls() {
  controls.forEach(c => c.style.opacity = '0');
}
document.body.addEventListener('click', showControls);
hideControls();

/* -------------------- Stream -------------------- */
function startStream() {
  status.textContent = "Connectingâ€¦";
  status.style.opacity = '1';

  if (hls) hls.destroy();

  video.muted = true;
  updateMute();

  if (Hls.isSupported()) {
    hls = new Hls({
      maxBufferLength: 20,
      maxMaxBufferLength: 30,
      backBufferLength: 0,
      liveSyncDuration: 10,
      lowLatencyMode: false
    });

    hls.loadSource(STREAM_URL);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play().catch(()=>{});
    });

    hls.on(Hls.Events.FRAG_BUFFERED, () => {
      status.style.opacity = '0';
    });

    hls.on(Hls.Events.ERROR, () => restartStream());

  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = STREAM_URL;
    video.play().catch(()=>{});
  }
}

function restartStream() {
  status.textContent = "Reconnectingâ€¦";
  status.style.opacity = '1';

  try {
    if (hls) hls.destroy();
    video.pause();
    video.removeAttribute("src");
    video.load();
  } catch {}

  setTimeout(startStream, 1500);
}

/* -------------------- Watchdog -------------------- */
video.addEventListener('timeupdate', () => {
  lastProgress = Date.now();
});

setInterval(() => {
  if (Date.now() - lastProgress > 20000) {
    restartStream();
  }
}, 5000);

/* -------------------- Periodic reload -------------------- */
// Hard reload every 6 hours (prevents WebView leaks)
setTimeout(() => location.reload(), 6 * 60 * 60 * 1000);

/* -------------------- Start -------------------- */
startStream();
</script>
</body>
</html>
